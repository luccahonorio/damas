import { darken } from 'polished';

export const squareLighter = 'rgb(212,198,159)';
export const squareDarker = 'rgb(142,108,80)';

export const pieceDarker = 'rgb(82,57,47)';
export const pieceLighter = 'rgb(230,183,79)';

export const board = [
  [
    { piece: null, color: squareLighter },
    {
      id: 1,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 2,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 3,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 4,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 5,
      piece: pieceDarker,
      color: squareDarker,
    },
  ],
  [
    {
      id: 6,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 7,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 8,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 9,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 10,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 11,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 12,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 13,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 14,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 15,
      piece: pieceDarker,
      color: squareDarker,
    },
  ],
  [
    {
      id: 16,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 17,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 18,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 19,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 20,
      piece: pieceDarker,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 21,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 22,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 23,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 24,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 25,
      piece: null,
      color: squareDarker,
    },
  ],
  [
    {
      id: 26,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 27,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 28,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 29,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 30,
      piece: null,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 31,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 32,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 33,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 34,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 35,
      piece: pieceLighter,
      color: squareDarker,
    },
  ],
  [
    {
      id: 36,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 37,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 38,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 39,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 40,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 41,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 42,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 43,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 44,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 45,
      piece: pieceLighter,
      color: squareDarker,
    },
  ],
  [
    {
      id: 46,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 47,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 48,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 49,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
    {
      id: 50,
      piece: pieceLighter,
      color: squareDarker,
    },
    { piece: null, color: squareLighter },
  ],
];

function handleGetIndex({ board, square }) {
  let indexSquare = null;

  board.forEach((row) =>
    row.forEach((sq) => {
      if (sq && sq.id && sq.id === square.id) {
        indexSquare = {
          row: board.indexOf(row),
          index: row.indexOf(sq),
          color: sq.piece,
          id: sq.id,
        };
      }
    })
  );

  return indexSquare;
}
//Handle if the peace can move by her position in the board
export function handlePositionPiece({ board, square }) {
  const squareIndex = handleGetIndex({ board, square });

  // lighter
  if (squareIndex.color === pieceLighter) {
    // if position is 9
    if (squareIndex.index === 9) {
      return {
        right: false,
        left: true,
      };
    }

    // if position is 0
    if (squareIndex.index === 0) {
      return {
        right: true,
        left: false,
      };
    }
  } else {
    // darker

    // if position is 9
    if (squareIndex.index === 9) {
      return {
        right: true,
        left: false,
      };
    }

    // if position is 0
    if (squareIndex.index === 0) {
      return {
        right: false,
        left: true,
      };
    }
  }

  // if is allowed on two ways
  return {
    right: true,
    left: true,
  };
}

export function handleAllowedPiece({ board, square, allowedMovements }) {
  const squareIndex = handleGetIndex({ board, square });

  // light
  // if right is allowed
  // if left is allowed
  // if both sides are allowed
  if (squareIndex.color === pieceLighter) {
    const row = squareIndex.row - 1;
    const index = squareIndex.index;

    if (allowedMovements.right) {
      const indexFutureSquare = handleGetIndex({
        board,
        square: board[row][index + 1],
      });
      if (indexFutureSquare.color !== pieceLighter) {
        // verificar se pode comer
        allowedMovements.right = indexFutureSquare;
      } else {
        allowedMovements.right = false;
      }
    }

    if (allowedMovements.left) {
      const indexFutureSquare = handleGetIndex({
        board,
        square: board[row][index - 1],
      });
      if (indexFutureSquare.color !== pieceLighter) {
        // verificar se pode comer
        allowedMovements.left = indexFutureSquare;
      } else {
        allowedMovements.left = false;
      }
    }

    return allowedMovements;
  } else {
    // dark
    // if right is allowed
    // if left is allowed
    // if both sides are allowed
    const row = squareIndex.row + 1;
    const index = squareIndex.index;

    if (allowedMovements.right) {
      const indexFutureSquare = handleGetIndex({
        board,
        square: board[row][index - 1],
      });
      if (indexFutureSquare.color !== pieceDarker) {
        // verificar se pode comer
        allowedMovements.right = indexFutureSquare;
      } else {
        allowedMovements.right = false;
      }
    }

    if (allowedMovements.left) {
      const indexFutureSquare = handleGetIndex({
        board,
        square: board[row][index + 1],
      });
      if (indexFutureSquare.color !== pieceDarker) {
        // verificar se pode comer
        allowedMovements.left = indexFutureSquare;
      } else {
        allowedMovements.left = false;
      }
    }

    return allowedMovements;
  }
}

function copyBoard({ board }) {
  const newBoard = JSON.parse(JSON.stringify(board)).map((row) => {
    return row.map((sq) => {
      if (sq.color !== squareDarker) {
        if (sq && sq.id) {
          sq.color = squareDarker;
        }
      }
      return sq;
    });
  });
  return newBoard;
}

export function printAllowedMovements({ allowedMovements, board }) {
  const newBoard = copyBoard({ board });

  if (allowedMovements.right) {
    newBoard[allowedMovements.right.row][
      allowedMovements.right.index
    ].color = darken(
      0.2,
      newBoard[allowedMovements.right.row][allowedMovements.right.index].color
    );
  }

  if (allowedMovements.left) {
    newBoard[allowedMovements.left.row][
      allowedMovements.left.index
    ].color = darken(
      0.2,
      newBoard[allowedMovements.left.row][allowedMovements.left.index].color
    );
  }
  return newBoard;
}

export function handlePieceMovement({ squareSelected, selected }) {}

export function handleMovePiece({ board, futureSquare, actualSquare }) {
  const newBoard = copyBoard({ board });
  const idFutureSquare = handleGetIndex({ board, square: futureSquare });
  const idActualSquare = handleGetIndex({ board, square: actualSquare });

  newBoard[idFutureSquare.row][idFutureSquare.index].piece = actualSquare.piece;

  newBoard[idActualSquare.row][idActualSquare.index].piece = null;

  return newBoard;
}
