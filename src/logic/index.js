const squareLighter = 'rgb(212,198,159)';
const squareDarker = 'rgb(142,108,80)';

const pieceDarker = 'rgb(82,57,47)';
const pieceLighter = 'rgb(230,183,79)';

export const tabu = [
  [
    { piece: null, color: squareLighter },
    {
      id: 1,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 2,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 3,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 4,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 5,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
  ],
  [
    {
      id: 6,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 7,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 8,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 9,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 10,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 11,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 12,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 13,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 14,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 15,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
  ],
  [
    {
      id: 16,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 17,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 18,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 19,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 20,
      piece: pieceDarker,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 21,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 22,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 23,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 24,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 25,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
  ],
  [
    {
      id: 26,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 27,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 28,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 29,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 30,
      piece: null,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 31,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 32,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 33,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 34,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 35,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
  ],
  [
    {
      id: 36,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 37,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 38,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 39,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 40,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
  ],
  [
    { piece: null, color: squareLighter },
    {
      id: 41,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 42,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 43,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 44,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 45,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
  ],
  [
    {
      id: 46,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 47,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 48,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 49,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
    {
      id: 50,
      piece: pieceLighter,
      color: squareDarker,
      allowed: { left: false, right: false },
      available: () => {},
    },
    { piece: null, color: squareLighter },
  ],
];

function handleAllowedLighter(square) {
  const squareIndex = getIndex(square);
  const row = squareIndex.row - 1;
  const sq = squareIndex.index;

  if (squareIndex.index === 9) {
    if (tabu[row][sq - 1].piece === null) {
      return {
        left: true,
        right: false,
      };
    } else {
      return {
        left: false,
        right: false,
      };
    }
  }

  if (squareIndex.index === 0) {
    if (tabu[row][sq + 1].piece === null) {
      return {
        left: false,
        right: true,
      };
    } else {
      return {
        left: false,
        right: false,
      };
    }
  }

  let response = { right: false, left: false };
  if (tabu[row][sq - 1].piece === null) {
    response.left = true;
  }
  if (tabu[row][sq + 1].piece === null) {
    response.right = true;
  }
  return response;
}

function handleAllowedDarken(square) {
  const squareIndex = getIndex(square);
  const row = squareIndex.row + 1;
  const sq = squareIndex.index;

  if (sq === 9) {
    if (tabu[row][sq - 1].piece === null) {
      return {
        left: false,
        right: true,
      };
    } else {
      return {
        left: false,
        right: false,
      };
    }
  }

  if (sq === 0) {
    if (tabu[row][sq + 1].piece === null) {
      return {
        left: true,
        right: false,
      };
    } else {
      return {
        left: false,
        right: false,
      };
    }
  }

  let response = { right: false, left: false };
  if (tabu[row][sq - 1].piece === null) {
    response.right = true;
  }
  if (tabu[row][sq + 1].piece === null) {
    response.left = true;
  }
  return response;
}

export function handleBorder() {
  const result = tabu.map((row) => {
    return row.map((sq) => {
      if (sq && sq.id && sq.piece) {
        if (sq.piece === pieceDarker) {
          return { ...sq, allowed: handleAllowedDarken(sq) };
        } else {
          return { ...sq, allowed: handleAllowedLighter(sq) };
        }
      }
      return sq;
    });
  });
  return result;
}

function getIndex(square) {
  let indexSquare = null;

  tabu.forEach((row) =>
    row.forEach((sq) => {
      if (sq && sq.id && sq.id === square.id) {
        indexSquare = {
          row: tabu.indexOf(row),
          index: row.indexOf(sq),
          color: sq.piece,
        };
      }
    })
  );

  return indexSquare;
}

export function showMovements(square) {
  // Finding index square
  let indexSquare = getIndex(square);

  // movements for black

  if (indexSquare.color === pieceDarker) {
    // se ele for 9 ele so move pra direita, se ele for 1 ele so move pra esquerda
    const row = indexSquare.row + 1;
    const sq = indexSquare.index;

    // if is on the edge
    if (row > 9 || row < 0) {
      return false;
    }

    // move if index is 9
    if (indexSquare.index === 9) {
      return {
        left: null,
        right: { ...tabu[row][sq - 1], row, square: sq - 1 },
      };
    }
    // move if index is 1
    if (indexSquare.index === 0) {
      return {
        left: { ...tabu[row][sq + 1], row, square: sq + 1 },
        right: null,
      };
    }

    // move on both sides
    return {
      right: { ...tabu[row][sq - 1], row, square: sq - 1 },
      left: { ...tabu[row][sq + 1], row, square: sq + 1 },
    };
  }

  // movements for white
  else {
    // se ele for 9 ele so move pra direita, se ele for 1 ele so move pra esquerda
    const row = indexSquare.row - 1;
    const sq = indexSquare.index;

    // if is on the edge
    if (row > 9 || row < 0) {
      return false;
    }

    // move if index is 9
    if (indexSquare.index === 9) {
      return {
        left: { ...tabu[row][sq - 1], row, square: sq - 1 },
        right: null,
      };
    }
    // move if index is 1
    if (indexSquare.index === 0) {
      return {
        left: null,
        right: { ...tabu[row][sq + 1], row, square: sq + 1 },
      };
    }

    // move on both sides
    return {
      left: { ...tabu[row][sq - 1], row, square: sq - 1 },
      right: { ...tabu[row][sq + 1], row, square: sq + 1 },
    };
  }
}

export function handleMove(actualPiece, futurePiece) {
  // checking if futurePiece is available
  if (!futurePiece.available) {
    return;
  }

  const indexActualPiece = getIndex(actualPiece);
  const indexFuturePiece = getIndex(futurePiece);

  // removing actual piece
  const pieceMoved = tabu[indexActualPiece.row][indexActualPiece.index].piece;

  tabu[indexActualPiece.row][indexActualPiece.index].piece = null;

  // puting in the future square
  tabu[indexFuturePiece.row][indexFuturePiece.index].piece = pieceMoved;
}
